(function(){var e,n,t,i,r,o;window.service_call=function(e,n,t,i,r){var o,u,a;r=r||i||t,i=i||t,4===arguments.length&&(i=void 0),3===arguments.length&&(t=void 0,i=void 0),t=t||{};for(o in t)a=t[o],null==a&&delete t[o];return u=n.search("\\?")>=0?"&":"?",$.ajax({type:e,url:""+n+u+$.param(t),contentType:"application/json",accepts:"application/json",dataType:"json",data:i?JSON.stringify(i):void 0,success:function(n){var t;return"success"===n.status?(t=void 0,n.more_url&&(t=function(t){return service_call(e,n.more_url,{},t)}),"function"==typeof r?r(void 0,n.result,t):void 0):"function"==typeof r?r(n):void 0},error:function(e,n,t){var i,o;o={error_code:"ajax_error",text_status:n,error_thrown:t,jqXHR:e};try{e.responseText&&(o=$.parseJSON(e.responseText))}catch(u){i=u,o=o}return LOG("service_call error",o),"function"==typeof r?r(o):void 0}})},window.LOG=function(){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log?console.log.apply(console,arguments):void 0},window.init_common=function(){return init_loading_button(),init_time()},window.init_loading_button=function(){return $("body").on("click",".btn-loading",function(){return $(this).button("loading")})},window.init_time=function(){var e;return $("time").length>0?(e=function(){return $("time[datetime]").each(function(){var e,n;return e=moment.utc($(this).attr("datetime")),n=moment().diff(e,"days"),$(this).text(n>25?e.local().format("YYYY-MM-DD"):e.fromNow()),$(this).attr("title",e.local().format("dddd, MMMM Do YYYY, HH:mm:ss Z"))}),setTimeout(arguments.callee,45e3)})():void 0},window.clear_notifications=function(){return $("#notifications").empty()},window.show_notification=function(e,n){return null==n&&(n="warning"),clear_notifications(),e?$("#notifications").append('<div class="alert alert-dismissable alert-'+n+'">\n  <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>\n  '+e+"\n</div>"):void 0},$(function(){return init_common()}),$(function(){return $("html.welcome").each(function(){return LOG("init welcome")})}),$(function(){return $("html.profile").each(function(){return init_profile()})}),$(function(){return $("html.feedback").each(function(){})}),$(function(){return $("html.user-list").each(function(){return init_user_list()})}),$(function(){return $("html.user-merge").each(function(){return init_user_merge()})}),$(function(){return $("html.admin-config").each(function(){return init_admin_config()})}),window.init_admin_config=function(){},window.init_profile=function(){},window.init_user_list=function(){return t(),e(),n()},t=function(){return $("input[name=user_db]").each(function(){return o($(this))}),$("#select-all").change(function(){return $("input[name=user_db]").prop("checked",$(this).is(":checked")),$("input[name=user_db]").each(function(){return o($(this))})}),$("input[name=user_db]").change(function(){return o($(this))})},o=function(e){return r(),$("input[name=user_db]").each(function(){var n;return n=e.val(),$("#"+n).toggleClass("warning",e.is(":checked"))})},r=function(){var e;return e=$("input[name=user_db]:checked").length,$("#user-actions").toggleClass("hidden",0===e),$("#user-merge").toggleClass("hidden",2>e),0===e?($("#select-all").prop("indeterminate",!1),$("#select-all").prop("checked",!1)):0===$("input[name=user_db]:not(:checked)").length?($("#select-all").prop("indeterminate",!1),$("#select-all").prop("checked",!0)):$("#select-all").prop("indeterminate",!0)},e=function(){return $("#user-delete").click(function(e){var n,t,i,o,u;return clear_notifications(),e.preventDefault(),n=$(this).data("confirm").replace("{users}",$("input[name=user_db]:checked").length),confirm(n)?(u=[],$("input[name=user_db]:checked").each(function(){return $(this).attr("disabled",!0),u.push($(this).val())}),t=$(this).data("service-url"),o=$(this).data("success"),i=$(this).data("error"),service_call("DELETE",t,{user_keys:u.join(",")},function(e,n){return e?($("input[name=user_db]:disabled").removeAttr("disabled"),void show_notification(i.replace("{users}",u.length),"danger")):$("#"+n.join(", #")).fadeOut(function(){return $(this).remove(),r(),show_notification(o.replace("{users}",u.length),"success")})})):void 0})},window.init_user_merge=function(){var e;return e=$("#user_keys").val(),service_call("GET","/_s"+location.pathname,{user_keys:e},function(e,n){return e?void LOG("Something went terribly wrong"):(window.user_dbs=n,$("input[name=user_db]").removeAttr("disabled"))}),$("input[name=user_db]").change(function(e){var n;return n=$(e.currentTarget).val(),i(n)})},i=function(e){var n,t,i,r;for($(".user-row").removeClass("success").addClass("danger"),$("#"+e).removeClass("danger").addClass("success"),r=[],t=0,i=user_dbs.length;i>t;t++){if(n=user_dbs[t],e===n.key){$("input[name=user_key]").val(n.key),$("input[name=username]").val(n.username),$("input[name=name]").val(n.name),$("input[name=email]").val(n.email);break}r.push(void 0)}return r},n=function(){return $("#user-merge").click(function(e){var n,t;return e.preventDefault(),n=[],$("input[name=user_db]:checked").each(function(){return n.push($(this).val())}),t=$(this).data("user-merge-url"),window.location.href=""+t+"?user_keys="+n.join(",")})}}).call(this);